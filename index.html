<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Freedom FM — Video Player</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <style>
    :root {
      --bg: #111;
      --panel: #1b1b1b;
      --accent: #00b894;
      --muted: #777;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif;
      background: var(--bg); color: #fff; display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; overflow-x: hidden;
    }
    header {
      background: #222; width: 100%; padding: 18px; text-align: center; font-weight: bold; font-size: 1.2em;
      position: relative; z-index: 10;
    }
    .menu-btn {
      position: absolute; right: 14px; top: 8px; background: none; border: none; color: #fff; font-size: 1.6em; cursor: pointer;
    }
    .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; backdrop-filter: blur(6px);
      background: rgba(0,0,0,.45); opacity: 0; visibility: hidden; transition: .3s; z-index: 9;
    }
    .overlay.show { opacity: 1; visibility: visible; }
    .sidebar {
      position: fixed; left: -260px; top: 0; width: 240px; height: 100%; background: rgba(20,20,20,.95);
      box-shadow: 2px 0 15px rgba(0,0,0,.5); transition: .3s; display: flex; flex-direction: column; padding-top: 60px; z-index: 10;
    }
    .sidebar.open { left: 0; }
    .sidebar a, .sidebar button {
      color: #fff; padding: 12px 18px; text-decoration: none; background: none; border: none; text-align: left; font-size: 1.05em; cursor: pointer;
    }
    .sidebar a:hover, .sidebar button:hover { background: #2c2c2c; }
    main { width: 100%; max-width: 980px; margin: 18px; }
    .player-panel {
      background: var(--panel); padding: 16px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,.6);
    }
    video { width: 100%; border-radius: 8px; background: #000; }
    .cms {
      background: var(--panel); padding: 16px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,.5); margin-top: 18px;
    }
    input[type=text], input[type=url] {
      width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #2a2a2a; background: #222; color: #fff; font-size: 1em;
    }
    .btn {
      display: inline-block; padding: 10px 16px; border-radius: 8px; border: none; background: var(--accent); color: #fff; cursor: pointer; font-weight: bold; font-size: 1em;
    }
    .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.6; }
    .toast {
      position: fixed; bottom: 20px; right: 20px; background: #00b894; padding: 10px 18px; border-radius: 8px;
      color: #fff; font-weight: bold; box-shadow: 0 0 10px #000; opacity: 0; transition: .4s; z-index: 100;
    }
    .toast.show { opacity: 1; }
    .toast.error { background: #e74c3c; }
    footer { text-align: center; padding: 12px; color: var(--muted); margin-top: auto; }
    @media (max-width: 980px) { main { margin: 12px; } }
  </style>
</head>
<body>

<header>
  <button class="menu-btn" id="menuBtn">Menu</button>
  Freedom FM Video
</header>

<div class="overlay" id="overlay"></div>
<div class="sidebar" id="sidebar">
  <a href="https://smile-wifi.github.io/Main" target="_blank">Home</a>
  <button id="cmsLink">CMS Settings</button>
  <button id="loginLink">Login</button>
  <button id="logoutLink" style="color:#ff7675;">Logout</button>
</div>

<main>
  <div class="player-panel">
    <video id="videoPlayer" controls autoplay muted loop></video>
    <div style="margin-top:10px; font-weight:bold;" id="videoTitle">Loading...</div>
  </div>

  <!-- Facebook-style CMS -->
  <div class="cms" id="cmsBox" style="display:none;">
    <h3>Update Video</h3>
    <input id="titleInput" placeholder="Video Title">
    <input id="linkInput" placeholder="Video URL (MP4)">
    <button class="btn" id="saveBtn" style="margin-top:12px;">Save to GitHub</button>
  </div>
</main>

<footer>
  © 2025 Smile WiFi — Video CMS
</footer>

<div id="toast" class="toast">Saved!</div>

<script>
/* === CONFIG === */
const DATA_URL = "https://smile-wifi.github.io/freedom-auto/data.json";
const WORKER_URL = "https://update-json.kaptenlanaja2024.workers.dev";
const PASSWORD = "freedom2025";

/* === DOM Elements === */
const menuBtn     = document.getElementById('menuBtn');
const sidebar     = document.getElementById('sidebar');
const overlay     = document.getElementById('overlay');
const cmsBox      = document.getElementById('cmsBox');
const loginLink   = document.getElementById('loginLink');
const logoutLink  = document.getElementById('logoutLink');
const cmsLink     = document.getElementById('cmsLink');
const saveBtn     = document.getElementById('saveBtn');

const videoPlayer = document.getElementById('videoPlayer');
const videoTitle  = document.getElementById('videoTitle');

const titleInput  = document.getElementById('titleInput');
const linkInput   = document.getElementById('linkInput');

const toast       = document.getElementById('toast');

/* === Sidebar === */
menuBtn.onclick = () => {
  sidebar.classList.toggle('open');
  overlay.classList.toggle('show');
};
overlay.onclick = () => {
  sidebar.classList.remove('open');
  overlay.classList.remove('show');
};

/* === Auth === */
loginLink.onclick = () => {
  const pw = prompt("Enter CMS password:");
  if (pw === PASSWORD) {
    sessionStorage.setItem('cmsAuth', 'true');
    showCms();
    showToast("Logged in!");
  } else {
    alert("Incorrect password");
  }
};

logoutLink.onclick = () => {
  sessionStorage.removeItem('cmsAuth');
  cmsBox.style.display = 'none';
  showToast("Logged out");
};

cmsLink.onclick = () => {
  if (!sessionStorage.getItem('cmsAuth')) return alert("Login required.");
  showCms();
};

function showCms() { cmsBox.style.display = 'block'; }

/* === Toast === */
function showToast(msg, isError = false) {
  toast.textContent = msg;
  toast.className = 'toast' + (isError ? ' error' : '');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

/* === Load Data === */
let data = {};

async function loadData() {
  try {
    const r = await fetch(DATA_URL + '?v=' + Date.now(), { cache: 'no-store' });
    if (!r.ok) throw new Error("Failed");
    data = await r.json();
  } catch (e) {
    console.warn("Fallback data", e);
    data = {
      title: "Big Buck Bunny",
      today_link: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
    };
  }
  displayVideo();
  if (sessionStorage.getItem('cmsAuth')) fillCms();
}

function displayVideo() {
  videoPlayer.src = data.today_link || '';
  videoTitle.innerText = data.title || 'No Title';
  videoPlayer.load();
}

/* === CMS Fill === */
function fillCms() {
  titleInput.value = data.title || '';
  linkInput.value  = data.today_link || '';
}

/* === SAVE === */
saveBtn.onclick = async () => {
  const newTitle = titleInput.value.trim();
  const newLink  = linkInput.value.trim();

  if (!newTitle || !newLink) {
    return showToast("Title and URL are required!", true);
  }

  saveBtn.disabled = true;
  saveBtn.textContent = "Saving...";

  const payload = { title: newTitle, today_link: newLink };

  try {
    const res = await fetch(WORKER_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({ error: "Failed" }));
      throw new Error(err.error || "HTTP " + res.status);
    }

    showToast("Saved! Video updated.");
    data = payload;
    displayVideo();
  } catch (e) {
    console.error(e);
    showToast("Save failed: " + e.message, true);
  } finally {
    saveBtn.disabled = false;
    saveBtn.textContent = "Save to GitHub";
  }
};

/* === Init === */
loadData();
if (sessionStorage.getItem('cmsAuth')) setTimeout(showCms, 500);
</script>

</body>
</html>
